<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>DNSCrypt Proxy Plugin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">DNSCrypt Proxy Plugin</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                                <h4 class="phpdocumentor-sidebar__root-namespace"><a href="namespaces/opnsense.html"><abbr title="\OPNsense">OPNsense</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="namespaces/opnsense-dnscryptproxy.html"><abbr title="\OPNsense\Dnscryptproxy">Dnscryptproxy</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/Default.html"><abbr title="\Default">Default</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="packages/OPNsense.html"><abbr title="\OPNsense">OPNsense</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="packages/OPNsense-Dnscryptproxy.html"><abbr title="\OPNsense\Dnscryptproxy">Dnscryptproxy</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/opnsense.html">OPNsense</a></li>
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/opnsense-dnscryptproxy.html">Dnscryptproxy</a></li>
            <li class="phpdocumentor-breadcrumb"><a href="namespaces/opnsense-dnscryptproxy-api.html">Api</a></li>
    </ul>

    <article class="phpdocumentor-element -class">
        <h2 class="phpdocumentor-content__title">
    SettingsController

        <span class="phpdocumentor-element__extends">
        extends <abbr title="\OPNsense\Base\ApiMutableModelControllerBase">ApiMutableModelControllerBase</abbr>
    </span>
    
            <div class="phpdocumentor-element__package">
            in package
            <ul class="phpdocumentor-breadcrumbs">
                                    <li class="phpdocumentor-breadcrumb"><a href="packages/OPNsense.html">OPNsense</a></li>
                                    <li class="phpdocumentor-breadcrumb"><a href="packages/OPNsense-Dnscryptproxy.html">Dnscryptproxy</a></li>
                            </ul>
        </div>
    
    
    </h2>

        <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">61</span>
</aside>

            <p class="phpdocumentor-summary">An ApiMutableModelControllerBase class used to perform settings related
actions for dnscrypt-proxy.</p>

    <section class="phpdocumentor-description"><p>This API is accessible at the following URL endpoint:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings</code></p>
<p>This class creates the following API endpoints:</p>
<pre class="prettyprint"><code class="prettyprint">  grid
  import
  export
  restoreSources
</code></pre>
<p>Functions with a name ending in &quot;Action&quot; become API endpoints by extending
<code class="prettyprint">ApiMutableModelControllerBase</code>.</p>
</section>








<h3 id="toc">
    Table of Contents
    <a href="#toc" class="headerlink"><i class="fas fa-link"></i></a>
</h3>

<dl class="phpdocumentor-table-of-contents">
                <dt class="phpdocumentor-table-of-contents__entry -property -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#property_valid_grid_targets">$valid_grid_targets</a>
    <span>
                &nbsp;: array&lt;string|int, mixed&gt;            </span>
</dt>
<dd>Array for defining valid targets to use with the functions within
this class.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -property -protected">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#property_internalModelClass">$internalModelClass</a>
    <span>
                &nbsp;: string            </span>
</dt>
<dd>Base model class to reference.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -property -protected">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#property_internalModelName">$internalModelName</a>
    <span>
                &nbsp;: string            </span>
</dt>
<dd>This variable defines what to call the &lt;model&gt; that is defined for this
Class by Phalcon. That is to say the model XML that has the same name as
this controller&#039;s name, &quot;Settings&quot;.</dd>

                <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_bootgridConfigd">bootgridConfigd()</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Execute a configd command, and return the output in a format consumable
by bootgrid.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_exportAction">exportAction()</a>
    <span>
                        &nbsp;: mixed    </span>
</dt>
<dd>Export entries out of an ArrayField type node in the config..

Uses a pre-defined set of targets (paths) to prevent arbitrary
export of data.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_gridAction">gridAction()</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>This is a super API for Bootgrid which will do all the things.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_importAction">importAction()</a>
    <span>
                        &nbsp;: mixed    </span>
</dt>
<dd>Import data provided by the user in a file upload into ArrayField type
nodes in the config.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_indexAction">indexAction()</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>An API endpoint to call when no parameters are
provided for the API. Can be used to test the API is working.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_initialize">initialize()</a>
    <span>
                        &nbsp;: mixed    </span>
</dt>
<dd>Initilize the class, populate the valid_grid_targets with values from the
form XML for this form.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -public">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_restoreSourcesAction">restoreSourcesAction()</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Special function to restore the default sources into the config.</dd>

            <dt class="phpdocumentor-table-of-contents__entry -method -private">
    <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_searchGrids">searchGrids()</a>
    <span>
                        &nbsp;: array&lt;string|int, mixed&gt;    </span>
</dt>
<dd>Form parser for bootgrid fields.</dd>

        </dl>



        

        
    <section class="phpdocumentor-properties">
        <h3 class="phpdocumentor-elements__header" id="properties">
            Properties
            <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#properties" class="headerlink"><i class="fas fa-link"></i></a>
        </h3>
                    <article
        class="
            phpdocumentor-element
            -property
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="property_valid_grid_targets">
        $valid_grid_targets
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#property_valid_grid_targets" class="headerlink"><i class="fas fa-link"></i></a>
        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">124</span>
</aside>

        <p class="phpdocumentor-summary">Array for defining valid targets to use with the functions within
this class.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
        <span class="phpdocumentor-signature__type">array&lt;string|int, mixed&gt;</span>
    <span class="phpdocumentor-signature__name">$valid_grid_targets</span>
     = <span class="phpdocumentor-signature__default-value">array()</span></code>

        <section class="phpdocumentor-description"></section>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -protected
            -static                                            "
>
    <h4 class="phpdocumentor-element__name" id="property_internalModelClass">
        $internalModelClass
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#property_internalModelClass" class="headerlink"><i class="fas fa-link"></i></a>
        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">116</span>
</aside>

        <p class="phpdocumentor-summary">Base model class to reference.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
    <span class="phpdocumentor-signature__static">static</span>    <span class="phpdocumentor-signature__type">string</span>
    <span class="phpdocumentor-signature__name">$internalModelClass</span>
     = <span class="phpdocumentor-signature__default-value">&#039;OPNsense\Dnscryptproxy\Settings&#039;</span></code>

        <section class="phpdocumentor-description"><p>This variable defines which class to call for getMode(). It is used in a
ReflectionClass call to establish the model object. This class is defined
in the models directory alongside the model XML, and has the same name
as this Controller. This class extends BaseModel which reads the model
XML that has the same name as the class.</p>
<p>In this case, these are the model XML file, and class definition file:</p>
<p><code class="prettyprint">model/OPNsense/Dnscryptproxy/Settings.xml</code></p>
<p><code class="prettyprint">model/OPNsense/Dnscryptproxy/Settings.php</code></p>
<p>These together will establish several API endpoints on this Controller's
endpoint including:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings/get</code></p>
<p><code class="prettyprint">/api/dnscryptproxy/settings/set</code></p>
<p>These are both defined in the ApiMutableModelControllerBase Class:</p>
<p><code class="prettyprint">function getAction()</code></p>
<p><code class="prettyprint">function setAction()</code></p>
</section>

    

</article>
                    <article
        class="
            phpdocumentor-element
            -property
            -protected
            -static                                            "
>
    <h4 class="phpdocumentor-element__name" id="property_internalModelName">
        $internalModelName
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#property_internalModelName" class="headerlink"><i class="fas fa-link"></i></a>
        <span class="phpdocumentor-element__modifiers">
                                </span>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">84</span>
</aside>

        <p class="phpdocumentor-summary">This variable defines what to call the &lt;model&gt; that is defined for this
Class by Phalcon. That is to say the model XML that has the same name as
this controller&#039;s name, &quot;Settings&quot;.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">protected</span>
    <span class="phpdocumentor-signature__static">static</span>    <span class="phpdocumentor-signature__type">string</span>
    <span class="phpdocumentor-signature__name">$internalModelName</span>
     = <span class="phpdocumentor-signature__default-value">&#039;settings&#039;</span></code>

        <section class="phpdocumentor-description"><p>In this case, it is the model XML file:</p>
<p><code class="prettyprint">model/OPNsense/Dnscryptproxy/Settings.xml</code></p>
<p>The model name is then used as the name of the array returned by setBase()
and getBase(). In the form XMLs, the prefix used on the field IDs must
match this name as API actions use the same name in their transactions.
For example, the key_name in an API JSON response, will be this model
name. This name is also used as the API endpoint for this Controller.</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings</code></p>
<p>This locks activies of this Class to this specific model, so it won't
save to other models, even within the same plugin.</p>
</section>

    

</article>
            </section>

            <section class="phpdocumentor-methods">
        <h3 class="phpdocumentor-elements__header" id="methods">
            Methods
            <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#methods" class="headerlink"><i class="fas fa-link"></i></a>
        </h3>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_bootgridConfigd">
        bootgridConfigd()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_bootgridConfigd" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">624</span>
</aside>

        <p class="phpdocumentor-summary">Execute a configd command, and return the output in a format consumable
by bootgrid.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">bootgridConfigd</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$configd_cmd</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$fields</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

        <section class="phpdocumentor-description"><p>It executes configd with the given commands, and returns JSON for bootrid
to consume. It works similar to, and sourced mostly from <code class="prettyprint">searchBase()</code>,
but with some differences and added functionality.</p>
<p>Takes most parameters via POST just like *Base() functions.</p>
<p>Lots of comments because this function is a bit confusing to start.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$configd_cmd</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>path to search, relative to this model</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$fields</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>field names to fetch in result</p>
</section>

            </dd>
            </dl>

    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
            &mdash;
            <section class="phpdocumentor-description"><p>output from the configd command</p>
</section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_exportAction">
        exportAction()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_exportAction" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">408</span>
</aside>

        <p class="phpdocumentor-summary">Export entries out of an ArrayField type node in the config..

Uses a pre-defined set of targets (paths) to prevent arbitrary
export of data.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">exportAction</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

        <section class="phpdocumentor-description"><p>API endpoint:
/api/dnscryptproxy/settings/export</p>
<p>Expects to receive a value &quot;target&quot; defined in the data in the GET
request.</p>
<p>Example usage (in Javascript):
ajaxGet(&quot;/api/dnscryptproxy/settings/export&quot;,
{&quot;target&quot;: &quot;allowed_names_internal&quot;},
function(data, status){...</p>
<p>The second parameter is the data (array) where &quot;target&quot; is defined.</p>
</section>

    
    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">mixed</span>
            &mdash;
            <section class="phpdocumentor-description"></section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_gridAction">
        gridAction()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_gridAction" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">235</span>
</aside>

        <p class="phpdocumentor-summary">This is a super API for Bootgrid which will do all the things.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">gridAction</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$action</span></span><span class="phpdocumentor-signature__argument"><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$target</span></span><span class="phpdocumentor-signature__argument"><span>[</span><span>, </span><span class="phpdocumentor-signature__argument__return-type">string&nbsp;</span><span class="phpdocumentor-signature__argument__name">$uuid</span><span> = </span><span class="phpdocumentor-signature__argument__default-value">null</span><span> ]</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

        <section class="phpdocumentor-description"><p>Instead of having many copies of the same functions over and over, this
function replaces all of them, and it requires only setting a couple of
variables and adjusting the conditional statements to add or remove
grids.</p>
<p>API endpoint:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings/grid</code></p>
<p>Parameters for this function are passed in via POST/GET request in the URL like so:</p>
<pre class="prettyprint"><code class="prettyprint">|-------API Endpoint (Here)-----|api|----$target---|--------------$uuid----------------|
api/dnscryptproxy/settings/grid/get/servers.server/9d606689-19e0-48a7-84b2-9173525255d8
</code></pre>
<p>This handles all of the bootgrid API calls, and keeps everything in
a single function. Everything is controled via the <code class="prettyprint">$target</code> and
pre-defined variables which include the config path, and the
key name for the edit dialog.</p>
<p>A note on the edit dialog, the <code class="prettyprint">$key_name</code> must match the prefix of
the IDs of the fields defined in the form data for that dialog.</p>
<p>Example:</p>
<pre class="prettyprint"><code class="prettyprint"> &lt;field&gt;
    &lt;id&gt;server.enabled&lt;/id&gt;
    &lt;label&gt;Enabled&lt;/label&gt;
    &lt;type&gt;checkbox&lt;/type&gt;
    &lt;help&gt;This will enable or disable the server stamp.&lt;/help&gt;
 &lt;/field&gt;
</code></pre>
<p>For the case above, the <code class="prettyprint">$key_name</code> must be: &quot;server&quot;</p>
<p>This correlates to the config path:</p>
<p><code class="prettyprint">//OPNsense/dnscrypt-proxy/servers/server</code></p>
<p><code class="prettyprint">servers</code> is the ArrayField that these bootgrid functions are designed
for.</p>
<p><code class="prettyprint">server</code>  is the final node in the config path, and are
entries in the ArrayField.</p>
<p>The <code class="prettyprint">$key_name</code>, the final node in the path, and the field ids in the form
XML must match. The field <id> is important because when <code class="prettyprint">mapDataToFormUI()</code>
runs to populate the fields with data, the scope is just the dialog
box (which includes the fields). It will try to match ids with the
data it receives, and it splits up the ids at the period, using the
first element as its <code class="prettyprint">key_name</code> for matching. This is also how the main
form works, and why all of those ids are prefixed with the model name.</p>
<p>So get/set API calls return a JSON with a key named 'server', and the
data gets sent to fields which have a dotted prefix of the same name.
This links these elements together, though they are not directly
linked, only merely aligned together.</p>
<p>Upon saving (using <code class="prettyprint">setBase()</code>) it sends the POST data specified
in the function call wholesale, that array has to overlay perfectly
on the model.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$action</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>The desired action to take for the API call.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$target</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>The desired pre-defined target for the API.</p>
</section>

            </dd>
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$uuid</span>
                : <span class="phpdocumentor-signature__argument__return-type">string</span>
                 = <span class="phpdocumentor-signature__argument__default-value">null</span>            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>The UUID of the target object.</p>
</section>

            </dd>
            </dl>

    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
            &mdash;
            <section class="phpdocumentor-description"><p>Array to be consumed by bootgrid.</p>
</section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_importAction">
        importAction()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_importAction" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">465</span>
</aside>

        <p class="phpdocumentor-summary">Import data provided by the user in a file upload into ArrayField type
nodes in the config.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">importAction</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

        <section class="phpdocumentor-description"><p>API endpoint:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings/import</code></p>
<p>Takes data from POST variables <code class="prettyprint">data</code> and <code class="prettyprint">target</code>, validates accordingly,
then updates existing objects with the same UUID, or creates new entries
then saves the entries into the config.</p>
<p>Example usage (Javascript):</p>
<pre class="prettyprint"><code class="prettyprint">ajaxCall(&quot;/api/dnscryptproxy/settings/import&quot;,
         {'data': import_data,'target': 'allowed_names_internal' },
         function(data,status) {...
</code></pre>
<p>The second paramter is the data (array) where <code class="prettyprint">data</code>, and <code class="prettyprint">target</code> are
defined.</p>
<p>No support for <code class="prettyprint">CSVListField</code> types within an ArrayField type.
Attempting currently returns error:</p>
<pre class="prettyprint"><code class="prettyprint">Error at /usr/local/opnsense/mvc/app/models/OPNsense/Base/FieldTypes/BaseField.php:639
It is not yet possible to assign complex types to properties (errno=2)
</code></pre>
<p>This was mostly copied from the firewall plugin.</p>
</section>

    
    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">mixed</span>
            &mdash;
            <section class="phpdocumentor-description"></section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_indexAction">
        indexAction()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_indexAction" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">161</span>
</aside>

        <p class="phpdocumentor-summary">An API endpoint to call when no parameters are
provided for the API. Can be used to test the API is working.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">indexAction</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

        <section class="phpdocumentor-description"><p>API endpoint:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings</code></p>
<p>Usage:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings</code></p>
<p>Returns an array which gets converted to json in the POST response.</p>
</section>

    
    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
            &mdash;
            <section class="phpdocumentor-description"><p>includes status, saying everything is A-OK</p>
</section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_initialize">
        initialize()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_initialize" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">137</span>
</aside>

        <p class="phpdocumentor-summary">Initilize the class, populate the valid_grid_targets with values from the
form XML for this form.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">initialize</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">mixed</span></code>

        <section class="phpdocumentor-description"><p>This parses the form XML for bootgrid fields, and puts them into a class
variable for use by other functions within the class.</p>
<p>This eliminates the needs to duplicate this information statically in the
class itself. All data is dynamically pulled from the form XML instead.</p>
</section>

    
    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">mixed</span>
            &mdash;
            <section class="phpdocumentor-description"></section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -public
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_restoreSourcesAction">
        restoreSourcesAction()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_restoreSourcesAction" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">563</span>
</aside>

        <p class="phpdocumentor-summary">Special function to restore the default sources into the config.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">public</span>
                <span class="phpdocumentor-signature__name">restoreSourcesAction</span><span>(</span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

        <section class="phpdocumentor-description"><p><strong>WARNING</strong>: This function <strong>WIPES</strong> ALL existing sources.source entires.</p>
<p>API endpoint:</p>
<p><code class="prettyprint">/api/dnscryptproxy/settings/restoreSources</code></p>
<p>This function will restore the sources back to the ones defined by
the application author inlcluded in the example <code class="prettyprint">dnscrypt-proxy.toml</code>.</p>
<p>This is probably not ideal with this data being hardcoded in the source.
I'll probably visit this later to see if I can come up with another way.</p>
<p>It uses a bit of a janky approach but was the best approach I could
figure out with the fewest lines of code, while also being fairly clear
about what is happening.</p>
</section>

    
    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
            &mdash;
            <section class="phpdocumentor-description"><p><code class="prettyprint">addBase()</code> results</p>
</section>

    
</article>
                    <article
        class="phpdocumentor-element
            -method
            -private
                                                        "
>
    <h4 class="phpdocumentor-element__name" id="method_searchGrids">
        searchGrids()
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#method_searchGrids" class="headerlink"><i class="fas fa-link"></i></a>
    </h4>
    <aside class="phpdocumentor-element-found-in">
    <abbr class="phpdocumentor-element-found-in__file" title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php"><a href="files/src-opnsense-mvc-app-controllers-opnsense-dnscryptproxy-api-settingscontroller.html"><abbr title="src/opnsense/mvc/app/controllers/OPNsense/Dnscryptproxy/Api/SettingsController.php">SettingsController.php</abbr></a></abbr>
    :
    <span class="phpdocumentor-element-found-in__line">311</span>
</aside>

        <p class="phpdocumentor-summary">Form parser for bootgrid fields.</p>

    <code class="phpdocumentor-code phpdocumentor-signature ">
    <span class="phpdocumentor-signature__visibility">private</span>
                <span class="phpdocumentor-signature__name">searchGrids</span><span>(</span><span class="phpdocumentor-signature__argument"><span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;&nbsp;</span><span class="phpdocumentor-signature__argument__name">$tabs</span></span><span>)</span><span> : </span><span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span></code>

        <section class="phpdocumentor-description"><p>This is used by initiatize() to walk through te tabs array to pull
bootgrid fields, and their respsective targets, and fields.</p>
<p>This funciton utilizes recursion to reduce code duplication.</p>
</section>

        <h5 class="phpdocumentor-argument-list__heading">Parameters</h5>
    <dl class="phpdocumentor-argument-list">
                    <dt class="phpdocumentor-argument-list__entry">
                <span class="phpdocumentor-signature__argument__name">$tabs</span>
                : <span class="phpdocumentor-signature__argument__return-type">array&lt;string|int, mixed&gt;</span>
                            </dt>
            <dd class="phpdocumentor-argument-list__definition">
                    <section class="phpdocumentor-description"><p>The form's tabs to be parsed.</p>
</section>

            </dd>
            </dl>

    

        <h5 class="phpdocumentor-return-value__heading">Return values</h5>
    <span class="phpdocumentor-signature__response_type">array&lt;string|int, mixed&gt;</span>
            &mdash;
            <section class="phpdocumentor-description"><p>Associtative array of targets, and their field
names.</p>
</section>

    
</article>
            </section>

    </article>
                <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
            </div>
        </div>
        <a href="classes/OPNsense-Dnscryptproxy-Api-SettingsController.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
</body>
</html>
